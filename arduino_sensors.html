<!DOCTYPE html>
<html>

  <script type="text/javascript">var blog_title = "Interrogating sensors";</script>
  <script type="text/javascript">var publication_date = "July 28, 2025";</script>
  <head>
    <link rel="icon" href="images/ml_logo.png">
    <meta charset='utf-8'>
    <meta name=viewport content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">
    <base target="_blank">
    <script src="javascripts/blog_head.js"></script>
  </head>
  <body>
    <script src="javascripts/blog_header.js"></script>
    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">


<p>
My favorite joke about sensors is a variant of
<a href="https://en.wikipedia.org/wiki/Segal's_law">Segal's law</a>.
</p>

<p>
<pre>
If you have a watch you always know what time it is.
If you have two watches, you're never sure.
</pre>
</p>

<p>
It's depressingly applicable to electromechanical systems. Once you can
read a sensor, you suddenly have ten thousand watches.
</p>

<h3><a id="Sensors-aren't-perfect"></a><a href="#Sensors-aren't-perfect">Sensors aren't perfect</a></h3>

<p>
You may not be aware of it, but when you have just one watch you tend
to have a particular mental model of how it's related to the actual time.
</p>

<p>
<figure>
  <img title="In a the simplest model of measurement, the time on the watch is the same as the actual time." alt="A diagram depicting the world time connected with an arrow to a watch
" src="images/arduino_sensors/trivial_model.png">
  <figcaption>In a the simplest model of measurement, the time on the watch is the same as the actual time.</figcaption>
</figure>
</p>

<p>
<figure>
  <img title="In practice, the measurement and tracking of time is a little messier." alt="A diagram depicting the world time connected with an arrow to an icon
depicting measurement, a pair of old school calipers, which is connected by
two other arrows to two wristwatches
" src="images/arduino_sensors/measurement_model.png">
  <figcaption>In practice, the measurement and tracking of time is a little messier.</figcaption>
</figure>
</p>

<p>
Measuring a thing introduces errors and imperfections. This is immediately
apparent when working with temperature. If I have one thermometer,
I can confidently report that I know what the temperature is.
</p>

<p>
<img alt="A photo of a thermometer showing the temperature
" src="images/arduino_sensors/one_thermometer.jpg">
</p>

<p>
But if I have five of them, I'm no longer sure.
</p>

<p>
<img alt="A photo of five thermometers, each showing a slightly different temperature
" src="images/arduino_sensors/five_thermometers.png">
</p>

<p>
Presumably all these thermometers are sitting at the same temperature,
inches apart on the same desk in the same room.
Some weirdness has been introduced in the process of measuring it though.
</p>

<p>
This introduces some troubling questions. Where is this weirdness coming from?
Can we correct for it? And more fundamentally, what even is the real temperature?
</p>

<p>
We'll spend the rest of this post trying to answer them.
</p>

<h3><a id="Connecting-to-an-Arduino"></a><a href="#Connecting-to-an-Arduino">Connecting to an Arduino</a></h3>

<p>
To really scale up our investigation of measurement, we're going to
<del>place an order for a million thermometers</del> connect a computer
to a digital thermometer.
The <a href="https://docs.arduino.cc/hardware/uno-wifi-rev2/">Arduino UNO Wifi Rev 2</a>
is a board containing, among other things, a microcontroller and a temperature
sensor. If this is your first exposure to Arduino and you'd like to get
started with your own, you can
<a href="https://brandonrohrer.com/arduino.html">take a side road here</a>
and come back.
</p>

<p>
After plugging in the Arduino Uno Wi-Fi Rev2, we’ll need to search for and
download the library that lets us measure temperature. The temperature
sensor is part of an inertial measurement unit (IMU) chip tucked unobtrusively
into the cityscape of the board. 
</p>

<p>
<figure>
  <img title="The IMU is a tiny chip, 2 1/2 by 3 mm, about 1/8 by 1/10 inch" alt="A photo of the UNO Wi-Fi Rev2 showing the microprocessor and IMU
" src="images/arduino_sensors/imu.png">
  <figcaption>The IMU is a tiny chip, 2 1/2 by 3 mm, about 1/8 by 1/10 inch</figcaption>
</figure>
</p>

<p>
The chip is the LSM6DS3 from a company called <a href="https://www.st.com">ST</a> and 
the library is called <code>Arduino_LSM6DS3</code>. To download it to the Arduino IDE,
navigate to <code>Tools</code> -> <code>Manage Libraries...</code>
</p>

<p>
<img alt="Screenshot of the menu option Manage Libraries highighted
" src="images/arduino_sensors/manage_libraries.png">
</p>

<p>
and search for "LSM6" in the dialog.
</p>

<p>
<img alt="Screenshot of the library search dialog with LSM6DS3 in the search bar
and the top result as Arduino_LSM6DS3
" src="images/arduino_sensors/install_library.png">
</p>

<p>
Click <code>Install</code> and we're all set up.
</p>

<p>
The IMU does several cool things, including measure acceleration
side-to-side (X), front-to-back (Y), and up-and-down (Z).
It also measures how fast the board is rotating in all three
<a href="https://en.wikipedia.org/wiki/Aircraft_principal_axes">principal directions</a>
pitch (X), roll (Y), and yaw (Z). Yaw is the motion of shaking your head No,
pitch is shaking your head Yes, and roll is tilting your head side to side
like a begging puppy. Because the tiny mechanisms that make these
measurements are temperature sensitive, the board includes its own
temperature sensor, which is then used to make some adjustments.
Lucky for us, we can also query it directly.
</p>

<p>
The capabilities that this library opens up our listed in the
<a href="https://github.com/arduino-libraries/Arduino_LSM6DS3/blob/master/docs/api.md">application programmer interface (API) documentation
</a>.
This is a list of the publicly available functions of the library. When you develop
a library and include a function description in the API documentation,
you are implying that it will always be available,
or at the very least that it won’t change. And in the event that you do
need to make a change to the official API, you do it with a lot of
communication and hoopla.
</p>

<p>
It's worth calling out that the links for <code>Arduino_LSM6DS3</code> library information
in the Arduino document library are broken at the moment I'm writing this.
That may be because they are a few years old or may be because someone
made a change somewhere in the documentation generation code that broke them.
Luckily, since Arduino is an open source project, we can go right to
the source&mdash;<a href="https://github.com/arduino-libraries/Arduino_LSM6DS3/tree/master">the Github repository
</a> where
it's all kept. That has the added bonus of never getting stale because
it is the ground truth.
</p>

<p>
You may notice in the list of functions available
that there is no way to access temperature from the API.
Some additional searches show that there is a way
<a href="https://github.com/arduino-libraries/Arduino_LSM6DS3/blob/master/examples/SimpleTempSensor/SimpleTempSensor.ino">get temperature</a>
using in the library, it’s just not included in the official documentation.
Using undocumented aspects of a library is a bit of a gamble.
They have no implied promise of consistency or support.
But since the only customers that are going to depend on the code
we write are ourselves, we are in a good position to acknowledge
and accept this risk. For what it’s worth, building on undocumented
behavior happens a lot.
</p>

<p>
<figure>
  <img title="from Randall Monroe at https://xkcd.com/1172/" alt="Every change breaks someone's workflow
" src="https://imgs.xkcd.com/comics/workflow.png">
  <figcaption>from Randall Monroe at https://xkcd.com/1172/</figcaption>
</figure>
</p>

<p>
The function we want is called <code>readTemperature()</code>, and our searches
also pulled up some example code for how to use it.
</p>

<p>
<pre>#include &lt;Arduino_LSM6DS3.h&gt; <br>
void setup() {
  Serial.begin(9600);
  while (!Serial); <br>
  if (!IMU.begin()) {
    Serial.println("Failed to initialize IMU!"); <br>
    while (1);
  } <br>
  Serial.print("Temperature sensor sample rate = ");
  Serial.print(IMU.temperatureSampleRate());
  Serial.println(" Hz");
  Serial.println();
  Serial.println("Temperature reading in degrees C");
} <br>
void loop() {
  float t; <br>
  if (IMU.temperatureAvailable()) {
    // after IMU.readTemperature() returns, t will contain the temperature reading
    IMU.readTemperature(t); <br>
    Serial.println(t);
  }
}</pre>
</p>

<p>
The most important things to take away for our own code are:
</p>

<p>
Include the library header file.
<pre>#include &lt;Arduino_LSM6DS3.h&gt;</pre>
</p>

<p>
Initialize the IMU in the <code>setup()</code> block.
<pre>IMU.begin()</pre>
</p>

<p>
Then read the temperature as often as we want in the <code>loop()</code> block.
Each time, first check whether there is a temperature measurement available.
<pre>if (IMU.temperatureAvailable()) {...</pre>
</p>

<p>
Then get a reading.
<pre>IMU.readTemperature(t);</pre>
</p>

<p>
This is the heart of the temperature-getting operation.
<code>IMU.readTemperature(t) takes a single input argument, a </code>float`,
whose value it modifies to hold the temperature in degrees C.
</p>

<p>
The <code>Serial.print()</code> function lets us keep an eye on the result,
as long as we keep the USB cable connected to the board. The line
</p>

<p>
<pre>Serial.begin(9600);</pre>
</p>

<p>
kicks off a serial bus connection between the laptop and the board
at baud rate (bits per second) of 9600. To watch what they talk about
on this connection, we need a serial port monitor. Luckily the Arduino IDE
comes with one built right in. To use it select <code>Tools</code> -> <code>Serial Monitor</code>
</p>

<p>
<img alt="screenshot of the Serial Monitor selection in the Tools dropdown" src="images/arduino_sensors/serial_monitor_select.png">
</p>

<p>
and on the far right of the Serial Monitor window that pops up,
make sure that <code>9600 baud</code> is selected in the dropdown menu.
</p>

<p>
<img alt="screenshot of the Serial Monitor window" src="images/arduino_sensors/baud_select.png">
</p>

<p>
And now we’re ready to take a measurement.
<a href="https://github.com/brohrer/arduinobots/blob/main/sketches/uno_wifi_rev2_sensor_test/uno_wifi_rev2_sensor_test.ino">Here's the actual code I'm using.</a>
</p>

<h3><a id="Reading-the-temperature"></a><a href="#Reading-the-temperature">Reading the temperature</a></h3>

<p>
After clicking the compile-and-upload arrow this line shows up in the
Serial Monitor
</p>

<p>
<pre>20.832 (69.498)</pre>
</p>

<p>
And just like that, we know what temperature the world is at
in this location and at this time! About 20.8 degrees Celsius or 
69.5 degrees Farenheit. It is consistent with the most straightforward
interpretation of measurement we can come up with.
</p>

<p>
<img alt="An icon of a thermometer labeled "world temperature" and an icon of dial
labeled "measured temperature"" src="images/arduino_sensors/trivial_temp_model.png">
</p>

<p>
The fun begins when we take another measurement ten seconds later.
</p>

<p>
<pre>21.281 (70.306)</pre>
</p>

<p>
Immediately panic sets in.
</p>

<p>
Did we change something?<br>
Did the temperature really go up?<br>
Was it wrong the first time?<br>
Was it wrong the second time?<br>
What is wrong both times???
</p>

<p>
There's no way to know. All we know is that we took one measurement
and then we took another, and they were different numbers.
This suggests that the measurement process is sophisticated enough
to merit special consideration.
</p>

<p>
<img alt="An icon of a thermometer labeled "world temperature" pointing to an icon of
a pair of antique calipers labeled "measurement process" which is pointing
to two icons of dials
labeled "measured temperature" src="images/arduino_sensors/temp_model.png">
</p>

<h3><a id="Going-deeper"></a><a href="#Going-deeper">Going deeper</a></h3>

<p>
It only gets worse as we collect additional measurements every few seconds.
</p>

<p>
<pre>21.512 (70.721)
21.832 (71.298)
22.047 (71.684)
22.410 (72.338)
22.805 (73.048)
22.957 (73.323)
23.223 (73.801)
23.434 (74.180)
23.672 (74.609)
23.898 (75.017)
24.133 (75.439)
24.363 (75.854)
24.785 (76.613)
24.441 (75.995)
24.492 (76.086)
24.711 (76.480)
24.770 (76.585)
24.977 (76.958)
25.461 (77.830)</pre>
</p>

<p>
The temperature keeps going up. We've watched it climb almost
5 &#176;C (9 &#176;F) in just a few minutes and there's no sign that
it's slowing down.
</p>

<p>
With an extended pattern like this it's really helpful to be able
to take regular readings and look at how they change over time.
There is
<a href="https://codeberg.org/brohrer/arduinobots/src/branch/main/sketches/uno_wifi_rev2_read_temp/uno_wifi_rev2_read_temp.ino">a tweaked version of the code
</a> 
that reads the temperature on a regular cadence, and there is the Serial Plotter
a convenient Arduino IDE display of any value that gets regularly
sent to the Serial Monitor. Open the Serial Plotter via <code>Tools</code> ->
<code>Serial Plotter</code>. 
</p>

<p>
Starting from an Arduino that had been powered down overnight,
reading the temperature every 10 seconds, the first 8 minutes (48 readings) 
show a steady climb over almost 3 &#176;C. 
</p>

<p>
<img alt="A plot showing 48 measurements in an upward curve starting at 23.6 and rising
to 26.4" src="images/arduino_sensors/temp_rise_8_min.png">
</p>

<p>
One limitation of the Serial Plotter is that it
only plots the 50 most recent data points.
The next couple of screenshots extend this curve over about 24 minutes,
but the y-axis scale changes on each one.
</p>

<p>
<img alt="A plot showing 50 measurements in an upward curve starting at 26.45 and rising
to 27.0" src="images/arduino_sensors/temp_rise_16_min.png">
</p>

<p>
<img alt="A plot showing 50 measurements in an upward curve starting at 27.0 and rising
to 27.3" src="images/arduino_sensors/temp_rise_24_min.png">
</p>

<p>
This pattern gives us a solid lead. For some reason the reported
temperature is definitely going up, and not just a little bit.
This is exciting! It is a clear signal that <em>something</em> is going on.
We just don't know what.
</p>

<h3><a id="Modeling-measurement"></a><a href="#Modeling-measurement">Modeling measurement</a></h3>

<p>
A cynical but pragmatic view of science is that its goal is to explain
what we see. A good theory explains everything we see. (And
<a href="https://en.wikipedia.org/wiki/Occam's_razor">Occam's Razor</a>
suggests that it's good practice to go with the simplest
explanation we can come up with.)
Another word for such an explanation is a <strong>model</strong>, and the most important
ingredients in a good model are careful observations.
</p>

<p>
To get some more observations for our model, I set the stage more carefully.
In the quiet of the morning with no air conditioning, after the Arduino
had cooled all night, I started collecting measurements every 20 seconds.
Due to operator error, I lost the first few measurements on the plot, but
they began close to 21.5 &#176;C.
</p>

<p>
<img alt="A plot showing 50 measurements in an upward curve starting at 22.7 and rising
to 25.1" src="images/arduino_sensors/temp_rise_17_min.png">
</p>

<p>
This curve tells us a lot, and helps us to start building our measurement model.
The steep start, easing into a plateau is a common curve in systems that
get hit with a sudden change but take a while to adjust to it. Eventually
that line will flatten out and settle in to the new normal.
</p>

<p>
This raises the question of What changed? The only
change I made was to plug in the Arduino and start collecting measurements.
Using the inductive (storytelling) superpowers of a human brain,
we can connect the unusual events together&mdash;plugging in the Arduino probably
caused the temperature to rise.
</p>

<p>
Although these aren't obviously connected, the relationship does make sense
after more careful consideration. Powering up the Arduino sends electrical
current through the IMU chip and through the microprocessor that sits just
a couple of centimeters away. Current heats them both up a little bit.
And unlike devices intended to measure air temperature, the temperature
sensor of the IMU sits isolated from the air, on a piece of silicon
with a lot of transistors and resistors that are each generating a small
amount of heat. These will cause the temperature of the integrated circuit
package to rise, until it gets warmer than the surrounding air, enough so
that the difference in temperatures helps it dump its extra heat.
</p>

<p>
With this picture of what's going on, we can update our measurement model.
</p>

<p>
To keep things grounded,
thermometers placed around the sensor show no such change.
</p>

<p>
Is the temperature in the room going up?
Is the hardware broken
</p>

<p>
That way madness lies. And the field of heat transfer.
</p>

<ol>
19.3
</ol>

<p>
about (count - 2) / 2 + 2 min
</p>

<p>
This suggests that the measurement process is sophisticated enough
to merit special consideration.
</p>

<p>
<hr>
</p>

<p>
https://en.wikipedia.org/wiki/Empiricism
</p>

<p>
https://en.wikipedia.org/wiki/Uncertainty_quantification#Aleatoric_and_epistemic
</p>

<p>
Arduino integers are 2 byte (16-bit), and have a maximum of 2^15 (32,768).
</p>

<p>
IMU chip
</p>

<p>
https://content.arduino.cc/assets/st_imu_lsm6ds3_datasheet.pdf
</p>

<p>
https://github.com/arduino-libraries/Arduino_LSM6DS3
</p>

        <script src="javascripts/blog_signature.js"></script>
      </section>
    </div>
    <script src="javascripts/blog_footer.js"></script>
  </body>
</html>
